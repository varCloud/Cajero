@model Cmv.Entidades.Cajas 

@{
    int TotalCajas = Model.lstCajas1.Count + Model.lstCajas2.Count + Model.lstCajas3.Count;
    ViewBag.Title = " •ESTATUS DE CAJAS• ";
}

<script>
    var total =  @TotalCajas;
</script>

<button data-modal="divEnviaCorreo" class="btn btn-default btn-sm md-trigger" id="btnAbrirDialog" style="display:none">3D Slit</button>
    <div class="md-modal md-3d-slit" id="divEnviaCorreo">
        <div class="md-content">
            <h3>Enviar correo de Aviso</h3>
             <div id="cuerpoDialogDetalle">
                  	<p id="msjAlert"> </p>
					<p>
                      @using (@Ajax.BeginForm("Enviar", new AjaxOptions() { HttpMethod = "Post", OnFailure = "OnFailure", OnBegin = "OnBegin", OnComplete = "OnComplete", OnSuccess = "OnSuccess" }))
                      {
                          
                          @Html.Hidden("items", Json.Encode(Model.lstCajas3));
                         <button type="button" class="btn btn-danger md-close" id="btnCerrarDialog">Cancelar</button>
					     <button type="submit" class="btn btn-success">Enviar</button>
                      }
					</p>
            </div>
        </div>
    </div>

    <script>
        var resizefunc = [];
    </script>

    @Scripts.Render("~/assets/libs/scriptTema")
    @Scripts.Render("~/bundles/jqueryval")
    
    <script src="~/assets/libs/jquery-datatables/js/jquery.dataTables.min.js"></script>
    <script src="~/assets/libs/jquery-datatables/js/dataTables.bootstrap.js"></script>
    <script src="~/assets/libs/jquery-datatables/extensions/TableTools/js/dataTables.tableTools.min.js"></script>
   
    
    <script src="~/Scripts/jsApp/indexApp.js"></script>





            <!-- ============================================================== -->
            <!-- Start Content here -->
            <!-- ============================================================== -->
            
                <!-- Start info box -->
                <div class="row top-summary">
                    <div class="col-lg-3 col-md-6">
                        <div class="widget green-3 animated fadeInDown">
                            <div class="widget-content padding">
                                <div class="widget-icon">
                                    <i class="icon-user"></i>
                                </div>
                                <div class="text-box">
                                    <p class="maindata">CAJAS <b>CORRECTAS</b></p>
                                    <h2>#<span class="animate-number" data-value="@Model.lstCajas1.Count" data-duration="3000">0</span></h2>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            <div class="widget-footer">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <i class="fa fa-caret-up rel-change"></i><b>39%</b> increase in traffic
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="widget btn-warning animated fadeInDown">
                            <div class="widget-content padding">
                                <div class="widget-icon">
                                    <i class="icon-user"></i>
                                </div>
                                <div class="text-box">
                                    <p class="maindata">CAJAS <b>PROXIMAS</b></p>
                                    <h2>#<span class="animate-number" data-value="@Model.lstCajas2.Count" data-duration="3000">0</span></h2>

                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            <div class="widget-footer">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <i class="fa fa-caret-down rel-change"></i><b>11%</b> decrease in sales
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="widget orange-2 animated fadeInDown">
                            <div class="widget-content padding">
                                <div class="widget-icon">
                                    <i class="icon-user"></i>
                                </div>
                                <div class="text-box">
                                    <p class="maindata">CAJAS <b>EXCEDIDAS</b></p>
                                    <h2>#<span class="animate-number" data-value="@Model.lstCajas3.Count" data-duration="3000">0</span></h2>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            <div class="widget-footer">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <i class="fa fa-caret-down rel-change"></i><b>7%</b> decrease in income
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="widget lightblue-1 animated fadeInDown">
                            <div class="widget-content padding">
                                <div class="widget-icon">
                                    <i class="fa fa-users"></i>
                                </div>
                                <div class="text-box">
                                    <p class="maindata">CAJAS <b>ABIERTAS</b></p>
                                    <h2>#<span class="animate-number" data-value="@TotalCajas" data-duration="3000">0</span></h2>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            <div class="widget-footer">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <i class="fa fa-caret-up rel-change"></i><b>6%</b> increase in users
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- End of info box -->

      
                <div class="row">
                    <div class="col-md-12 portlets">
                        <div class="widget">
                            <div class="widget-header transparent">
                                <h2><strong>Grafico de</strong> Sucursales</h2>
                                <div class="additional-btn">
                                    <a href="#" class="hidden reload"><i class="icon-ccw-1"></i></a>
                                    <a href="#" class="widget-toggle"><i class="icon-down-open-2"></i></a>
                                    <a href="#" class="widget-close"><i class="icon-cancel-3"></i></a>
                                </div>
                            </div>
                            <div class="widget-content padding">
                                <div id="donut-example"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" id="CajasExcedidas">
                    <div class="col-md-12">
                        <div class="widget">
                            <div class="widget-header" style="background-color: #DE745E">
                                <h2 class="green-3 " style="color: white"><strong>Cajas</strong> Execedidas</h2>
                                <div class="additional-btn">
                                    <a href="#" class="hidden reload"><i class="icon-ccw-1"></i></a>
                                    <a href="#" class="widget-toggle"><i class="icon-down-open-2"></i></a>
                                    <a href="#" class="widget-close"><i class="icon-cancel-3"></i></a>
                                </div>
                            </div>
                            <div class="widget-content">
                                <br>
                                <div class="table-responsive">
                                    <form class='form-horizontal' role='form'>
                                        <table id="datatables-Excedidas" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Nombre Usuario</th>
                                                    <th>Sucursal</th>
                                                    <th>Disponible Caja</th>
                                                    <th>Maximo Caja</th>
                                                </tr>
                                            </thead>

                                            <tfoot>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Nombre Usuario</th>
                                                    <th>Sucursal</th>
                                                    <th>Disponible Caja</th>
                                                    <th>Maximo Caja</th>
                                                </tr>
                                            </tfoot>
                                            <tbody id="cuerpoExcedidas">
                                                @{
                                                    int i = 0;
                                                    foreach (Cmv.Entidades.Disponible item in @Model.lstCajas3)
                                                    {
                                                    <tr>
                                                        <td><input type="checkbox" class="rows-check" id="check_@i"></td>
                                                        <td>@item.NombreUsuario </td>
                                                        <td>@item.DescSucursal </td>
                                                        <td>@item.DisponibleCaja.ToString("C2") </td>
                                                        <td>@item.MaximoDisponible.ToString("C2") </td>
                                                    </tr>
                                                        i++;
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" id="CajasProximas">
                    <div class="col-md-12">
                        <div class="widget">
                            <div class="widget-header" style="background-color: #F5B84F">
                                <h2 class=" " style="color: white"><strong>Cajas</strong> Proximas</h2>
                                <div class="additional-btn">
                                    <a href="#" class="hidden reload"><i class="icon-ccw-1"></i></a>
                                    <a href="#" class="widget-toggle"><i class="icon-down-open-2"></i></a>
                                    <a href="#" class="widget-close"><i class="icon-cancel-3"></i></a>
                                </div>
                            </div>
                            <div class="widget-content">
                                <br>
                                <div class="table-responsive">
                                    <form class='form-horizontal' role='form'>
                                        <table id="datatables-Proximas" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>Nombre Usuario</th>
                                                    <th>Sucursal</th>
                                                    <th>Disponible Caja</th>
                                                    <th>Maximo Caja</th>
                                                </tr>
                                            </thead>

                                            <tfoot>
                                                <tr>
                                                    <th>Nombre Usuario</th>
                                                    <th>Sucursal</th>
                                                    <th>Disponible Caja</th>
                                                    <th>Maximo Caja</th>
                                                </tr>
                                            </tfoot>
                                            <tbody id="cuerpoProxima">
                                                @{
                                                    foreach (Cmv.Entidades.Disponible item in @Model.lstCajas2)
                                                    {
                                                    <tr>
                                                        <td>@item.NombreUsuario </td>
                                                        <td>@item.DescSucursal </td>
                                                        <td>@item.DisponibleCaja.ToString("C2") </td>
                                                        <td>@item.MaximoDisponible.ToString("C2") </td>
                                                    </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <div id="downCajas">
                <div class="row" id="CajasCorrectas">
                    <div class="col-md-12">
                        <div class="widget">
                            <div class="widget-header" style="background-color: #209C83">
                                <h2 style="color: white"><strong>Cajas</strong> Correctas</h2>
                                <div class="additional-btn">
                                    <a href="#" class="hidden reload"><i class="icon-ccw-1"></i></a>
                                    <a href="#" class="widget-toggle"><i class="icon-down-open-2"></i></a>
                                    <a href="#" class="widget-close"><i class="icon-cancel-3"></i></a>
                                </div>
                            </div>
                            <div class="widget-content">
                                <br>
                                <div class="table-responsive">
                                    <form class='form-horizontal' role='form'>
                                        <table id="datatables-Correctas" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>Nombre Usuario</th>
                                                    <th>Sucursal</th>
                                                    <th>Disponible Caja</th>
                                                    <th>Maximo Caja</th>
                                                </tr>
                                            </thead>

                                            <tfoot>
                                                <tr>
                                                    <th>Nombre Usuario</th>
                                                    <th>Sucursal</th>
                                                    <th>Disponible Caja</th>
                                                    <th>Maximo Caja</th>
                                                </tr>
                                            </tfoot>
                                            <tbody id="">
                                                @{
                                                    foreach (Cmv.Entidades.Disponible item in @Model.lstCajas1)
                                                    {
                                                    <tr>
                                                        <td>@item.NombreUsuario </td>
                                                        <td>@item.DescSucursal </td>
                                                        <td>@item.DisponibleCaja.ToString("C2") </td>
                                                        <td>@item.MaximoDisponible.ToString("C2") </td>
                                                    </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


           

            
            <!-- ============================================================== -->
            <!-- End content here -->
            <!-- ============================================================== -->

        
<script>
    Morris.Donut({
        element: 'donut-example',
        resize: true,
        backgroundColor: '#ccc',
        labelColor: '#060',
        data: [
          { label: "Cajas Correctas", value: @Model.lstCajas1.Count },
       { label: "Cajas Proximas",  value: @Model.lstCajas2.Count },
       { label: "Cajas Excedidas", value: @Model.lstCajas3.Count }
            ],
            colors: [
                  '#209C83',
                  '#F5B84F',
                  '#DE745E',
                  '#95D7BB'
            ],
        }).on('click', function (i, row) {  
            Abrir(i);
        });

        function OnBegin() {
            $( "#btnCerrarDialog" ).trigger( "click" );
        }
        function OnSuccess(data) {
            alert(data);
        }
        function OnFailure(request, error) {
            alert("Error");

        }
        function OnComplete(request, status) {
            alert("Completo")
            if(data)
                $("#md-3d-slit").modal('close');
            else
                alert(data);
        } 

        $("#datatables-Excedidas").dataTable();
        $("#datatables-Proximas").dataTable();
        $("#datatables-Correctas").dataTable();

        function Abrir(fila)
        {
            // alert(fila);
            switch (fila) {
                case 0:
                    break;
                case 1:
                    $( "#downCajas" ).slideDown( "slow" , function() {
                        alert ('Efecto slideDown con velocidad slow terminado!');
                    });
                    /* $("#msjAlert").html("<span>Estas seguro que deseas mandar correo a las sucursales  que estan por llegar al efectivo maximo permitido</span>");
                     $( "#btnAbrirDialog" ).trigger( "click" );*/
                    break;
                case 2:
                    $( "#downCajas" ).slideDown( "slow" );
                    /*$("#msjAlert").html("<span>Estas seguro que deseas mandar correo a las sucursales  que han excedido el efectivo maximo permitido</span>");
                    $( "#btnAbrirDialog" ).trigger( "click" );*/
                    break;
                default:
            }
        }
    </script>